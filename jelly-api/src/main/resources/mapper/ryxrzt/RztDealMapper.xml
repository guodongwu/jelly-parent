<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ryx.ryxrzt.mapper.RztDealMapper">

  <resultMap id="BaseResultMap" type="com.ryx.ryxrzt.entity.RztDealExpand">
    <result column="branchId" jdbcType="VARCHAR" property="branchId" />
    <result column="branchName" jdbcType="VARCHAR" property="branchName"/>
    <result column="dealDate" jdbcType="VARCHAR" property="dealDate" />
    <result column="amount" jdbcType="VARCHAR" property="amount" />
    <result column="onlyCode" jdbcType="VARCHAR" property="onlyCode" />
    <result column="dealtypeId" jdbcType="VARCHAR" property="dealTypeId" />
    <result column="termId" jdbcType="VARCHAR" property="termId" />
    <result column="fee" jdbcType="VARCHAR" property="fee" />
    <result column="customerId" jdbcType="VARCHAR" property="customerId" />
    <result column="customerName" jdbcType="VARCHAR" property="customerName" />
    <result column="customermobile" jdbcType="VARCHAR" property="customerMobile" />
    <result column="dealTypeName" jdbcType="VARCHAR" property="dealTypeName" />
    <result column="agencyName" jdbcType="VARCHAR" property="agencyName" />
    <result column="frAmt" jdbcType="VARCHAR" property="frAmt"/>
  </resultMap>
  <!--获取交易列表-->
  <select id="getDealList" resultMap="BaseResultMap" parameterType="java.util.HashMap">

    SELECT
    to_char(to_date(a.deal_date||a.deal_time,'yyyyMMddhh24miss'),'yyyy-mm-dd hh24:mi:ss') dealDate,
    to_char(TRUNC(a.trans_amt,2),'FM9999999999999990.00')||'元' amount,
    a.only_code onlyCode,
    a.dealtype_id dealtypeId,
    a.terminal_id termId,
    a.fee_amt fee,
    a.customerId,
    SUBSTR(a.customername, 0, 1) || '**' customerName,
    a.moblieno customermobile,
    b.name dealTypeName,
    b.branchId,
    d.NAME branchName,
    c.agency_name agencyName,
    nvl(a.FR_AMT,0) frAmt
    FROM
    RZT_DEAL a LEFT JOIN
    RZT_DEAL_TYPE  b
    on
    a.DEALTYPE_ID=b.DEALTYPE_ID
    LEFT JOIN
    RZT_AGENCY_INFO c
    on
    a.AGENCY_ID=c.AGENCY_ID
    LEFT  JOIN
    RZT_BRANCH d
    ON
    b.BRANCHID=d.BRANCHID
    <where>
      <if test="dealTypeId!=null">
        and a.DEALTYPE_ID=#{dealTypeId}
      </if>
      <if test="onlyCode!=null">
        and a.only_code=#{onlyCode} -- LIKE CONCAT(CONCAT('%', #{onlyCode}), '%')
      </if>
      <if test="termId!=null">
        and a.terminal_id=#{termId} -- LIKE CONCAT(CONCAT('%', #{termId}), '%')
      </if>
      <choose>
        <when test="startDate!=null and endDate!=null">
          and a.DEALDATE between #{startDate} and #{endDate}
        </when>
        <when test="startDate!=null">
          and a.DEALDATE=#{startDate} -- 20191122
        </when>
        <when test="endDate!=null">
          and a.DEALDATE=#{endDate} -- 20191122
        </when>
        <otherwise>
        </otherwise>
      </choose>
      <if test="customer!=null">
        and (a.customer_id like CONCAT(CONCAT('%', #{customer}), '%')
        or a.customername like CONCAT(CONCAT('%', #{customer}), '%')
        or a.moblieno like CONCAT(CONCAT('%', #{customer}), '%'))
      </if>
      <if test="agency!=null">
        and (c.mobile like ONCAT(CONCAT('%', #{agency}), '%')
        or c.agency_id like ONCAT(CONCAT('%', #{agency}), '%')
        or c.agency_name like ONCAT(CONCAT('%', #{agency}), '%'))
      </if>
      <if test="branchId!=null">
        and branchId=#{branchId}
      </if>
    </where>
  </select>
</mapper>